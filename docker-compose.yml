services:
  github-runner:
    build:
      context: .
      dockerfile: runner.dockerfile
    container_name: github-runner
    restart: unless-stopped
    environment:
      - GITHUB_URL=${GITHUB_URL}
      - RUNNER_TOKEN=${GITHUB_RUNNER_TOKEN}
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    privileged: true

  cloudflared-http:
    image: cloudflare/cloudflared:latest
    container_name: cloudflared-http
    restart: unless-stopped
    command: tunnel --no-autoupdate run --token ${CLOUDFLARE_HTTP_TUNNEL_TOKEN}

  cloudflared-ssh:
    image: cloudflare/cloudflared:latest
    container_name: cloudflared-ssh
    restart: unless-stopped
    command: tunnel --no-autoupdate run --token ${CLOUDFLARE_SSH_TUNNEL_TOKEN}
    extra_hosts:
      - "host.docker.internal:host-gateway"

  nginx:
    image: nginx:alpine
    container_name: nginx
    restart: unless-stopped
    ports:
      - 80:80